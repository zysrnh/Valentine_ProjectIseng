<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Envelope Letter</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gamja+Flower&family=Caveat:wght@400..700&display=swap" rel="stylesheet">

<style>
:root{
  --primary: white;
  --bg-envelope-color: #f5edd1;
  --envelope-tab: #ecdeb8;
  --envelope-cover: #e6cfa7;
  --shadow-color: #1c1c1c;
  --heart-color: #c2465d;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body{
  font-family: "Gamja Flower", cursive;
  background: linear-gradient(135deg, #fb7185, #f9a8d4);
  overflow: hidden;
  height: 100vh;
}

/* ================= LOVE RAIN ================= */
#love-container{
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 99999999;
}
.love{
  position: absolute;
  top: -60px;
  animation: fall linear infinite;
  opacity: .85;
}
@keyframes fall{
  to{ transform: translateY(110vh); }
}

/* ================= PASSWORD SCREEN ================= */
#pass-screen{
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #fb7185, #f9a8d4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999999;
  transition: opacity 0.7s ease, visibility 0s linear 0.7s;
}
#pass-screen.hide{
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.pass-card{
  background: rgba(255, 220, 225, 0.55);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border: 1.5px solid rgba(255,255,255,0.6);
  border-radius: 32px;
  padding: 40px 44px 36px;
  text-align: center;
  box-shadow: 0 8px 40px rgba(225,29,72,0.15), 0 2px 12px rgba(0,0,0,0.07);
  max-width: 320px;
  width: 88vw;
  animation: cardPop 0.6s cubic-bezier(.34,1.56,.64,1) both;
}

.pass-title{
  font-size: 1.8rem;
  color: #fff;
  text-shadow: 0 2px 8px rgba(185,28,60,0.2);
  margin-bottom: 6px;
}
.pass-sub{
  font-size: 1.1rem;
  color: #ffe4e6;
  margin-bottom: 24px;
}

.pin-display{
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 24px;
}
.pin-dot{
  width: 16px;
  height: 16px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.8);
  background: transparent;
  transition: background 0.2s ease;
}
.pin-dot.filled{ background: white; }

.keypad{
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  max-width: 220px;
  margin: 0 auto;
}
.key{
  font-family: "Gamja Flower", cursive;
  font-size: 1.4rem;
  background: rgba(255,255,255,0.35);
  border: 1.5px solid rgba(255,255,255,0.5);
  border-radius: 50%;
  width: 58px;
  height: 58px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: white;
  margin: 0 auto;
  transition: background 0.15s ease, transform 0.1s ease;
  user-select: none;
}
.key:active{ background: rgba(255,255,255,0.6); transform: scale(0.93); }
.key.del{ font-size: 1rem; }
.key.empty{ visibility: hidden; pointer-events: none; }

@keyframes shake{
  0%,100%{ transform: translateX(0); }
  20%    { transform: translateX(-8px); }
  40%    { transform: translateX(8px); }
  60%    { transform: translateX(-6px); }
  80%    { transform: translateX(6px); }
}
.pass-card.shake{ animation: shake 0.4s ease; }

#wrongText{
  font-size: 1rem;
  color: #fff;
  height: 22px;
  margin-top: 10px;
  opacity: 0;
  transition: opacity 0.3s ease;
}
#wrongText.show{ opacity: 1; }

/* ================= CALENDAR SCREEN ================= */
#cal-screen{
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #fb7185, #f9a8d4);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  gap: 18px;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.7s ease;
}
#cal-screen.show{ opacity: 1; visibility: visible; }
#cal-screen.hide{
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 0.8s ease, visibility 0s linear 0.8s;
}

.cal-label{
  font-size: 1.4rem;
  color: #fff;
  opacity: 0;
  animation: none;
  text-shadow: 0 2px 8px rgba(185,28,60,0.2);
}
.cal-label.anim{ animation: fadeUp 0.5s ease 0.1s forwards; }

.calendar{
  width: 200px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 16px 48px rgba(185,28,60,0.35), 0 4px 16px rgba(0,0,0,0.12);
  opacity: 0;
  animation: none;
}
.calendar.anim{ animation: fadeUp 0.5s ease 0.3s forwards; }

.cal-header{
  background: #e11d48;
  color: white;
  text-align: center;
  padding: 12px 0 10px;
  font-size: 1.1rem;
  letter-spacing: 2px;
}
.cal-body{
  background: white;
  height: 160px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}
.cal-num{
  font-size: 7rem;
  font-weight: 900;
  color: #e11d48;
  line-height: 1;
  position: absolute;
  user-select: none;
  font-family: "Gamja Flower", cursive;
}

@keyframes flipOut{
  0%   { transform: rotateX(0deg);   opacity: 1; }
  100% { transform: rotateX(-90deg); opacity: 0; }
}
@keyframes flipIn{
  0%   { transform: rotateX(90deg);  opacity: 0; }
  100% { transform: rotateX(0deg);   opacity: 1; }
}
.cal-num.flip-out{ animation: flipOut 0.22s ease-in  forwards; transform-origin: center bottom; }
.cal-num.flip-in { animation: flipIn  0.22s ease-out forwards; transform-origin: center top; }

.cal-hearts{ font-size: 1.8rem; letter-spacing: 8px; opacity: 0; transition: opacity 0.5s ease; }
.cal-hearts.show{ opacity: 1; }
.cal-sub{ font-size: 1.6rem; color: #fff; text-shadow: 0 2px 8px rgba(185,28,60,0.2); opacity: 0; transition: opacity 0.6s ease; }
.cal-sub.show{ opacity: 1; }

@keyframes fadeUp{
  from{ opacity:0; transform:translateY(16px); }
  to  { opacity:1; transform:translateY(0); }
}

/* ================= ENTRANCE ================= */
#entrance{
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #fb7185, #f9a8d4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 0.7s ease;
}
#entrance.show{ opacity: 1; visibility: visible; pointer-events: all; }

.card{
  background: rgba(255, 220, 225, 0.55);
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border: 1.5px solid rgba(255,255,255,0.6);
  border-radius: 32px;
  padding: 36px 44px 40px;
  text-align: center;
  box-shadow: 0 8px 40px rgba(225,29,72,0.15), 0 2px 12px rgba(0,0,0,0.07);
  max-width: 340px;
  width: 88vw;
  position: relative;
}
.card.pop{ animation: cardPop 0.6s cubic-bezier(.34,1.56,.64,1) both; }
@keyframes cardPop{
  from{ opacity:0; transform:scale(0.85) translateY(24px); }
  to  { opacity:1; transform:scale(1)    translateY(0); }
}
.card::before{ content:"â™¥"; position:absolute; top:14px; left:18px; font-size:1rem; color:rgba(225,29,72,0.25); pointer-events:none; }
.card::after { content:"â™¥"; position:absolute; bottom:14px; right:18px; font-size:1rem; color:rgba(225,29,72,0.25); pointer-events:none; }

.snoopy-wrap{ position:relative; height:115px; margin-bottom:10px; }
#snoopyHappy{ width:105px; display:block; margin:0 auto; filter:drop-shadow(0 6px 14px rgba(225,29,72,0.2)); transition:opacity 0.35s ease; }
#snoopySad{ width:105px; position:absolute; top:0; left:50%; transform:translateX(-50%); opacity:0; filter:drop-shadow(0 6px 14px rgba(225,29,72,0.2)); transition:opacity 0.35s ease; }

.question{ font-size:1.85rem; color:#fff; text-shadow:0 2px 8px rgba(185,28,60,0.2); line-height:1.25; margin-bottom:6px; }
#dynamicText{ font-size:1.15rem; color:#ffe4e6; height:30px; line-height:30px; transition:opacity 0.25s ease; opacity:0; margin-bottom:18px; }
.btn-row{ display:flex; justify-content:center; align-items:center; gap:14px; }

#yesBtn{ font-family:"Gamja Flower",cursive; font-size:1.2rem; background:#e11d48; color:white; border:none; padding:12px 38px; border-radius:50px; cursor:pointer; box-shadow:0 4px 16px rgba(225,29,72,0.4); transition:transform 0.2s ease, box-shadow 0.2s ease; }
#yesBtn:hover{ transform:scale(1.07); box-shadow:0 6px 22px rgba(225,29,72,0.55); }

#noBtn{ font-family:"Gamja Flower",cursive; font-size:1.2rem; background:white; color:#e11d48; border:none; padding:12px 28px; border-radius:50px; cursor:pointer; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition:transform 0.3s ease; transform:translate(0px,0px); position:relative; z-index:2; }

/* ================= CARD PHOTO SCREEN ================= */
#card-screen{
  position: fixed;
  inset: 0;
  background: linear-gradient(135deg, #fb7185, #f9a8d4);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 8888;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.8s ease;
}
#card-screen.show{
  opacity: 1;
  visibility: visible;
}
#cardImg{
  width: min(80vw, 360px);
  border-radius: 20px;
  box-shadow: 0 16px 48px rgba(185,28,60,0.35), 0 4px 16px rgba(0,0,0,0.12);
  animation: none;
}
#cardImg.pop{
  animation: cardPop 0.6s cubic-bezier(.34,1.56,.64,1) both;
}

/* ================= ENVELOPE ================= */
.container{ height:100vh; display:grid; place-items:center; }
.container > .envelope-wrapper{ background:var(--bg-envelope-color); box-shadow:0 0 40px var(--shadow-color); }
.envelope-wrapper > .envelope{ position:relative; width:350px; height:250px; }
.envelope-wrapper > .envelope::before{ content:""; position:absolute; top:0; z-index:2; border-top:130px solid var(--envelope-tab); border-right:175px solid transparent; border-left:175px solid transparent; transform-origin:top; transition:all 0.5s ease-in-out 0.7s; }
.envelope-wrapper > .envelope::after{ content:""; position:absolute; z-index:2; width:0; height:0; border-top:130px solid transparent; border-right:175px solid var(--envelope-cover); border-bottom:120px solid var(--envelope-cover); border-left:175px solid var(--envelope-cover); }
.sincerely{ text-align:right; }
.envelope > .letter{ position:absolute; right:20%; bottom:0; width:54%; height:80%; background:var(--primary); text-align:center; transition:all 1s ease-in-out; box-shadow:0 0 5px var(--shadow-color); padding:20px 10px; overflow:hidden; }
.envelope > .letter > .text{ font-family:"Caveat",cursive; color:black; text-align:justify; font-size:11px; padding-right:2px; }
.letter-card-img{ display:none; width:100%; margin-top:8px; border-radius:6px; }
.flap .letter-card-img{ display:block; }
.text strong{ font-size:12px; }
.heart{ position:absolute; top:50%; left:50%; width:15px; height:15px; background:var(--heart-color); z-index:4; transform:translate(-50%,-20%) rotate(45deg); transition:transform 0.5s ease-in-out 1s; box-shadow:0 1px 6px var(--shadow-color); cursor:pointer; }
.heart:before,.heart:after{ content:""; position:absolute; width:15px; height:15px; background-color:var(--heart-color); border-radius:50%; }
.heart:before{ top:-7.5px; }
.heart:after{ right:7.5px; }
.flap > .envelope:before{ transform:rotateX(180deg); z-index:0; }
.flap > .envelope > .letter{ bottom:100px; transform:scale(1.5); transition-delay:1s; }
.flap > .heart{ transform:rotate(90deg); transition-delay:0.4s; }
</style>
</head>
<body>

<!-- BACKSOUND -->
<audio id="bgm" src="Asset/theme.mpeg" loop preload="auto"></audio>

<div id="love-container"></div>

<!-- PASSWORD SCREEN -->
<div id="pass-screen">
  <div class="pass-card" id="passCard">
    <p class="pass-title">ğŸ” Enter Password</p>
    <p class="pass-sub">Cobaa Tebakkk </p>
    <div class="pin-display" id="pinDisplay">
      <div class="pin-dot" id="d0"></div>
      <div class="pin-dot" id="d1"></div>
      <div class="pin-dot" id="d2"></div>
      <div class="pin-dot" id="d3"></div>
      <div class="pin-dot" id="d4"></div>
      <div class="pin-dot" id="d5"></div>
    </div>
    <div class="keypad">
      <div class="key" data-n="1">1</div>
      <div class="key" data-n="2">2</div>
      <div class="key" data-n="3">3</div>
      <div class="key" data-n="4">4</div>
      <div class="key" data-n="5">5</div>
      <div class="key" data-n="6">6</div>
      <div class="key" data-n="7">7</div>
      <div class="key" data-n="8">8</div>
      <div class="key" data-n="9">9</div>
      <div class="key empty"></div>
      <div class="key del" data-n="del">âŒ«</div>
    </div>
    <p id="wrongText">Salah password! Coba lagi ğŸ™ˆ</p>
  </div>
</div>

<!-- CALENDAR SCREEN -->
<div id="cal-screen">
  <p class="cal-label" id="calLabel">February</p>
  <div class="calendar" id="calCard">
    <div class="cal-header">FEBRUARY ğŸ’•</div>
    <div class="cal-body">
      <span class="cal-num" id="calNum">1</span>
    </div>
  </div>
  <div class="cal-hearts" id="calHearts">ğŸ’— ğŸ’— ğŸ’—</div>
  <p class="cal-sub" id="calSub">It's Valentine's Day! ğŸ’Œ</p>
</div>

<!-- ENTRANCE -->
<div id="entrance">
  <div class="card" id="card">
    <div class="snoopy-wrap">
      <img id="snoopyHappy" src="Asset/Snoopy/Snoopy.png">
      <img id="snoopySad"   src="Asset/Snoopy/SadSnopy.png">
    </div>
    <p class="question">Will you be<br>my Valentine? ğŸ’Œ</p>
    <p id="dynamicText">&nbsp;</p>
    <div class="btn-row">
      <button id="yesBtn">Yes â¤ï¸</button>
      <button id="noBtn">No</button>
    </div>
  </div>
</div>

<!-- CARD PHOTO SCREEN -->
<div id="card-screen">
  <img src="Asset/Card.png" id="cardImg">
</div>

<!-- ENVELOPE -->
<div class="container">
  <div class="envelope-wrapper">
    <div class="envelope">
      <div class="letter">
        <div class="text">
          <strong>Dear Riaa,</strong>
          <p>sayanggg Happy Valentine's Day !, maafff akuu baruu nggucapinn sayanggg, butt i really really lovee youu soo muchhh, soo i madee thiss but it's not don yet...</p>
          <p class="sincerely">Sincerely, Zaaki &lt;3</p>
        </div>
      </div>
    </div>
    <div class="heart"></div>
  </div>
</div>

<script>
/* ---- LOVE RAIN ---- */
const loveContainer = document.getElementById("love-container");
function createLove(){
  const love = document.createElement("img");
  love.src = "Asset/Love/PixelLove.png";
  love.classList.add("love");
  love.style.width = (Math.random()*40+30)+"px";
  love.style.left  = Math.random()*100+"vw";
  const dur = Math.random()*5+5;
  love.style.animationDuration = dur+"s";
  loveContainer.appendChild(love);
  setTimeout(()=>love.remove(), dur*1000);
}
setInterval(createLove, 400);

function delay(ms){ return new Promise(r => setTimeout(r, ms)); }

/* ---- BGM â€” mulai saat interaksi pertama (klik keypad) ---- */
const bgm = document.getElementById("bgm");
bgm.volume = 0.5;
let bgmStarted = false;
function startBgm(){
  if(bgmStarted) return;
  bgmStarted = true;
  bgm.play().catch(()=>{});
}

/* ---- PASSWORD ---- */
const CORRECT = "271224";
let pin = "";
const passScreen = document.getElementById("pass-screen");
const passCard   = document.getElementById("passCard");
const wrongText  = document.getElementById("wrongText");
const dots       = Array.from({length:6}, (_,i) => document.getElementById("d"+i));

function updateDots(){
  dots.forEach((d,i) => d.classList.toggle("filled", i < pin.length));
}

document.querySelectorAll(".key").forEach(key => {
  key.addEventListener("click", ()=>{
    startBgm(); /* mulai musik saat tombol pertama ditekan */
    const n = key.dataset.n;
    if(n === "del"){
      pin = pin.slice(0,-1);
      updateDots();
      return;
    }
    if(pin.length >= 6) return;
    pin += n;
    updateDots();

    if(pin.length === 6){
      if(pin === CORRECT){
        passScreen.classList.add("hide");
        setTimeout(()=> startCalendar(), 700);
      } else {
        wrongText.classList.add("show");
        passCard.classList.add("shake");
        setTimeout(()=>{
          passCard.classList.remove("shake");
          pin = "";
          updateDots();
          setTimeout(()=> wrongText.classList.remove("show"), 800);
        }, 500);
      }
    }
  });
});

/* ---- CALENDAR ---- */
const calNum    = document.getElementById("calNum");
const calScreen = document.getElementById("cal-screen");
const calHearts = document.getElementById("calHearts");
const calSub    = document.getElementById("calSub");
const entrance  = document.getElementById("entrance");
const card      = document.getElementById("card");

function flipTo(next){
  return new Promise(resolve => {
    calNum.classList.add("flip-out");
    setTimeout(()=>{
      calNum.classList.remove("flip-out");
      calNum.textContent = next;
      calNum.classList.add("flip-in");
      setTimeout(()=>{ calNum.classList.remove("flip-in"); resolve(); }, 230);
    }, 220);
  });
}

async function startCalendar(){
  calScreen.classList.add("show");
  document.getElementById("calLabel").classList.add("anim");
  document.getElementById("calCard").classList.add("anim");

  await delay(900);
  for(let n = 2; n <= 14; n++){
    const wait = n < 10 ? 320 : n < 13 ? 220 : 160;
    await flipTo(n);
    await delay(wait);
  }

  await delay(300);
  calHearts.classList.add("show");
  await delay(400);
  calSub.classList.add("show");
  await delay(1800);

  entrance.style.visibility = "visible";
  card.classList.remove("pop");
  void card.offsetWidth;
  card.classList.add("pop");
  entrance.classList.add("show");
  calScreen.classList.add("hide");
}

/* ---- NO BTN ---- */
const noBtn       = document.getElementById("noBtn");
const dynamicText = document.getElementById("dynamicText");
const sadMessages = ["kenapaa gamauu sayanggg", "pleaseee"];
let msgIndex = 0, escaped = false, curTX = 0, curTY = 0;
const MAX_MOVE = 90, FLEE_DIST = 100;
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }

function showSadState(){
  document.getElementById("snoopyHappy").style.opacity = "0";
  document.getElementById("snoopySad").style.opacity   = "1";
  dynamicText.style.opacity = "0";
  setTimeout(()=>{
    dynamicText.textContent = sadMessages[msgIndex % sadMessages.length];
    dynamicText.style.opacity = "1";
    msgIndex++;
  }, 200);
}

noBtn.addEventListener("click", ()=>{
  if(!escaped){ escaped = true; msgIndex = 0; showSadState(); }
});

let lastFlee = false;
document.addEventListener("mousemove", (e)=>{
  if(!escaped) return;
  const r = noBtn.getBoundingClientRect();
  const dx = (r.left+r.width/2) - e.clientX;
  const dy = (r.top+r.height/2) - e.clientY;
  const dist = Math.sqrt(dx*dx+dy*dy);
  if(dist < FLEE_DIST){
    const angle = Math.atan2(dy,dx);
    const step  = (FLEE_DIST - dist) * 0.5;
    curTX = clamp(curTX + Math.cos(angle)*step, -MAX_MOVE, MAX_MOVE);
    curTY = clamp(curTY + Math.sin(angle)*step, -MAX_MOVE, MAX_MOVE);
    noBtn.style.transform = `translate(${curTX}px,${curTY}px)`;
    if(!lastFlee){
      lastFlee = true;
      dynamicText.style.opacity = "0";
      setTimeout(()=>{
        dynamicText.textContent = sadMessages[msgIndex % sadMessages.length];
        dynamicText.style.opacity = "1";
        msgIndex++;
      }, 150);
    }
  } else { lastFlee = false; }
});

/* ---- YES ---- */
document.getElementById("yesBtn").addEventListener("click", ()=>{
  entrance.style.opacity = "0";
  entrance.style.transition = "opacity 0.7s ease";
  setTimeout(()=>{
    entrance.style.visibility = "hidden";
    entrance.style.pointerEvents = "none";
  }, 700);
});

/* ---- ENVELOPE ---- */
const envelopeWrapper = document.querySelector(".envelope-wrapper");
const cardScreen      = document.getElementById("card-screen");
const cardImg         = document.getElementById("cardImg");
let flapped = false;

envelopeWrapper.addEventListener("click", function(){
  if(!flapped){
    /* klik pertama â€” buka amplop */
    flapped = true;
    this.classList.add("flap");
  } else {
    /* klik kedua â€” fade out amplop, tampilkan foto */
    const container = document.querySelector(".container");
    container.style.transition = "opacity 0.8s ease";
    container.style.opacity = "0";
    setTimeout(()=>{
      container.style.visibility = "hidden";
      cardImg.classList.remove("pop");
      void cardImg.offsetWidth;
      cardImg.classList.add("pop");
      cardScreen.classList.add("show");
    }, 700);
  }
});
</script>
</body>
</html>